/*! angular-cubes 2015-06-13 */
var ngCubes=angular.module("ngCubes",["ngCubes.templates"]),makeSignal=function(a){return"cubes_"+Math.random().toString(36).replace(/[^a-z]+/g,"")};ngCubes.filter("numeric",function(){return function(a){return numeral(a).format("0,0")}}),ngCubes.directive("cubes",["$http","$rootScope",function(a,b){return{restrict:"E",transclude:!0,scope:{slicer:"@",cube:"@",state:"=",changeState:"&"},templateUrl:"angular-cubes-templates/cubes.html",controller:function(c){var d=this,e=c.state||{},f=[],g=c.slicer.slice(),g=g.endsWith("/")?g.slice(0,g.length-1):g,g=g+"/cube/"+c.cube;d.dataUpdate=makeSignal(),d.stateUpdate=makeSignal(),d.modelUpdate=makeSignal(),d.init=function(){a.get(g+"/model").then(function(a){b.$broadcast(d.modelUpdate,a.data),b.$broadcast(d.stateUpdate,e)}),d.query()},d.getState=function(){return e},d.setState=function(a){e=a,b.$broadcast(d.stateUpdate,e),c.changeState&&c.changeState(e)},d.registerQueryProcessor=function(a){f.push(a)},d.getQuery=function(){var a={drilldown:[],cut:[],page:0,pagesize:20,order:[]};for(var b in f){var c=f[b];a=c(a,e)}for(var d in a)angular.isArray(a[d])&&(a[d]=a[d].join("|")),a[d].length||delete a[d];return a},d.query=function(){var c=d.getQuery();a.get(g+"/aggregate",{params:c}).then(function(a){b.$broadcast(d.dataUpdate,a.data,c)})},d.init()}}}]),ngCubes.directive("cubesPanel",["$rootScope",function(a){return{restrict:"EA",require:"^cubes",scope:{},templateUrl:"angular-cubes-templates/panel.html",link:function(b,c,d,e){b.model=null,b.state={},b.create={};var f=function(){var a=b.state.aggregates?b.state.aggregates:[];return angular.isArray(a)?a:[a]};b.getSelectedAggregates=function(){var a=[],c=f(),d=b.model?b.model.aggregates||[]:[];for(var e in d)-1!=c.indexOf(d[e].name)&&a.push(d[e]);return a},b.getAvailableAggregates=function(){var a=[],c=f(),d=b.model?b.model.aggregates||[]:[];for(var e in d)-1==c.indexOf(d[e].name)&&a.push(d[e]);return a},b.addAggregate=function(){var a=f();a.push(b.create.aggregate),b.state.aggregates=a,b.create.aggregate=null,e.setState(b.state),e.query()},a.$on(e.modelUpdate,function(a,c){b.model=c}),a.$on(e.stateUpdate,function(a,c){b.state=c;var d=b.getAvailableAggregates();d.length&&!b.create.aggregate&&(b.create.aggregate=d[0].name)})}}}]),ngCubes.directive("cubesTable",["$rootScope",function(a){return{restrict:"EA",require:"^cubes",scope:{drilldown:"="},templateUrl:"angular-cubes-templates/table.html",link:function(b,c,d,e){var f=null;b.columns=[],b.headers=[],b.table=[],e.registerQueryProcessor(function(a,b){return a}),a.$on(e.modelUpdate,function(a,b){f=b}),a.$on(e.dataUpdate,function(a,b,c){})}}}]),angular.module("ngCubes.templates",["angular-cubes-templates/cubes.html","angular-cubes-templates/panel.html","angular-cubes-templates/table.html","angular-cubes-templates/workspace.html"]),angular.module("angular-cubes-templates/cubes.html",[]).run(["$templateCache",function(a){a.put("angular-cubes-templates/cubes.html",'<div class="cubes-frame" ng-transclude>\n</div>\n')}]),angular.module("angular-cubes-templates/panel.html",[]).run(["$templateCache",function(a){a.put("angular-cubes-templates/panel.html",'<div class="panel panel-default" ng-if="model">\n  <div class="panel-heading">Values</div>\n  <table class="table">\n    <tr ng-repeat="a in getSelectedAggregates()">\n      <td>{{a.label}}</td>\n      <td>\n        <button class="btn btn-default"\n          ng-click="removeAggregate(a)">Remove</button>\n      </td>\n    </tr>\n    <tr>\n      <td>\n        <select name="aggregates" class="form-control"\n          ng-model="create.aggregate"\n          ng-options="a.name as a.label for a in getAvailableAggregates()"\n          ng-init="getAvailableAggregates()">\n        </select>\n      </td>\n      <td>\n        <button class="btn btn-default"\n          ng-disabled="!create.aggregate"\n          ng-click="addAggregate()">Add</button>\n      </td>\n    </tr>\n  </table>\n</div>\n')}]),angular.module("angular-cubes-templates/table.html",[]).run(["$templateCache",function(a){a.put("angular-cubes-templates/table.html",'<table class="table table-bordered table-condensed table-cubes">\n  <tr>\n    <th ng-repeat="h in headers" colspan="{{h.colspan}}">\n      {{h.label}}\n    </th>\n  </tr>\n  <tr>\n    <th ng-repeat="c in columns">\n      {{c.name}}\n    </th>\n  </tr>\n  <tr ng-repeat="row in table">\n    <td ng-repeat="c in columns" ng-class="c.type">\n      <span ng-if="c.type == \'numeric\'">\n        {{ row[c.column] | numeric }}\n      </span>\n      <span ng-if="c.type != \'numeric\'">\n        {{ row[c.column] }}\n      </span>\n    </td>\n  </tr>\n</table>\n\n{{data.total_cell_count}}\n')}]),angular.module("angular-cubes-templates/workspace.html",[]).run(["$templateCache",function(a){a.put("angular-cubes-templates/workspace.html",'<cubes slicer="{{slicer}}" cube="{{cube}}" state="state" change-state="updateState(state)">\n  <div class="row">\n    <div class="col-md-9">\n      <cubes-table></cubes-table>\n    </div>\n    <div class="col-md-3">\n      <cubes-panel></cubes-panel>\n    </div>\n  </div>\n</cubes>\n')}]),ngCubes.directive("cubesWorkspace",["$location",function(a){return{restrict:"EA",scope:{slicer:"@",cube:"@"},templateUrl:"angular-cubes-templates/workspace.html",link:function(b,c,d,e){b.state={};var f=function(){b.state=a.search()};b.updateState=function(b){a.search(b)},f()}}}]);