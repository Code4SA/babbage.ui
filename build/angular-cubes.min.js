/*! angular-cubes 2015-06-06 */
var ngCubes=angular.module("ngCubes",["ngCubes.templates"]),makeSignal=function(a){return"cubes_"+Math.random().toString(36).replace(/[^a-z]+/g,"")};ngCubes.filter("numeric",function(){return function(a){return numeral(a).format("0,0")}}),ngCubes.directive("cubes",["$http","$rootScope",function(a,b){return{restrict:"E",transclude:!0,scope:{slicer:"@",cube:"@",state:"=",changeState:"&"},templateUrl:"angular-cubes-templates/cubes.html",controller:function(c){var d=this,e=c.state||{q:{}},f=c.slicer.slice(),f=f.endsWith("/")?f.slice(0,f.length-1):f,f=f+"/cube/"+c.cube;d.dataUpdate=makeSignal(),d.modelUpdate=makeSignal(),d.init=function(){a.get(f+"/model").then(function(a){b.$broadcast(d.modelUpdate,a.data)})},d.getQuery=function(){return e.q},d.notifyState=function(a){c.changeState&&c.changeState(a)},d.updateQuery=function(c){var g=angular.copy(c);e.q=c,d.notifyState(e),a.get(f+"/aggregate",{params:e.q}).then(function(a){b.$broadcast(d.dataUpdate,a.data,g)})}}}}]),ngCubes.directive("cubesTable",["$rootScope",function(a){return{restrict:"EA",require:"^cubes",scope:{drilldown:"="},templateUrl:"angular-cubes-templates/table.html",link:function(b,c,d,e){var f=null,g={};b.columns=[],b.headers=[],b.table=[],a.$on(e.modelUpdate,function(a,b){f=b}),a.$on(e.dataUpdate,function(a,c,d){if(g=d,f){var e=[],h=[],i=[];for(var j in c.levels)for(var k in f.dimensions){var l=f.dimensions[k];l.name==j&&i.push(l)}for(var m in i){var j=i[m],n=j.name+".",o=0;for(var k in c.attributes){var p=c.attributes[k];if(p.startsWith(n)){var q=p.split(".")[1];h.push({name:q,column:p,type:"text"}),o++}}e.push({label:j.label,colspan:o})}for(var m in c.aggregates){var p=c.aggregates[m];for(var k in f.aggregates){var r=f.aggregates[k];r.name==p&&(r.type="numeric",r.column=r.name,r.colspan=1,h.push(r),e.push(r))}}b.table=c.cells,b.columns=h,b.headers=e}}),e.init(),e.updateQuery(e.getQuery())}}}]),angular.module("ngCubes.templates",["angular-cubes-templates/cubes.html","angular-cubes-templates/table.html","angular-cubes-templates/workspace.html"]),angular.module("angular-cubes-templates/cubes.html",[]).run(["$templateCache",function(a){a.put("angular-cubes-templates/cubes.html",'<div class="cubes-frame" ng-transclude>\n</div>\n')}]),angular.module("angular-cubes-templates/table.html",[]).run(["$templateCache",function(a){a.put("angular-cubes-templates/table.html",'<table class="table table-bordered table-condensed table-cubes">\n  <tr>\n    <th ng-repeat="h in headers" colspan="{{h.colspan}}">\n      {{h.label}}\n    </th>\n  </tr>\n  <tr>\n    <th ng-repeat="c in columns">\n      {{c.name}}\n    </th>\n  </tr>\n  <tr ng-repeat="row in table">\n    <td ng-repeat="c in columns" ng-class="c.type">\n      <span ng-if="c.type == \'numeric\'">\n        {{ row[c.column] | numeric }}\n      </span>\n      <span ng-if="c.type != \'numeric\'">\n        {{ row[c.column] }}\n      </span>\n    </td>\n  </tr>\n</table>\n\n{{data.total_cell_count}}\n')}]),angular.module("angular-cubes-templates/workspace.html",[]).run(["$templateCache",function(a){a.put("angular-cubes-templates/workspace.html",'<cubes slicer="{{slicer}}" cube="{{cube}}" state="state" state-change="updateState">\n  <cubes-table></cubes-table>\n</cubes>\n')}]),ngCubes.directive("cubesWorkspace",["$location",function(a){return{restrict:"EA",scope:{slicer:"@",cube:"@"},templateUrl:"angular-cubes-templates/workspace.html",link:function(b,c,d,e){b.state={};var f=function(a,b,c){var d=b.split("."),e=d[0],g=d.splice(1).join(".");return 0==g.length?a[e]=c:a[e]=f(a[e]||{},g,c),a},g=function(a,b,c){for(var d in b){var e=b[d],f=d;c&&(f=c+"."+f),angular.isObject(e)?a=g(a,e,f):a[f]=e}return a},h=function(){var c=a.search(),d={};for(var e in c)d=f(d,e,c[e]);b.state=d};b.updateState=function(){a.search(g({},b.state,null))},h()}}}]);